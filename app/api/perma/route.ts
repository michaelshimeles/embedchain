import { NextRequest, NextResponse } from "next/server";
import Arweave from "arweave";
import { JWKInterface } from "arweave/node/lib/wallet";

export async function POST(req: NextRequest) {
  // const payload = await req.json();

  // #1 Get the data from the POST request; encoded as base64 string.

  // #2 Make a connection to Arweave server; following standard example.
  try {
    const arweave = Arweave.init({
      host: "arweave.net",
      port: 443,
      protocol: "https",
    });

    const embeddings = `
  [-0.01118876,-0.019282605,-0.014818511,-0.0036083574,-0.04338586,0.014212363,-0.020951292,-0.03793767,-0.011759251,-0.031405546,0.016201952,-0.0075162225,0.006607002,-0.0045674955,-0.006482207,0.010040646,0.041360617,-0.021735717,0.043186188,-0.016986378,0.00046530695,0.011916136,-0.014354987,-0.012329742,-0.012108677,0.012978677,0.030350136,-0.026199812,0.03451472,-0.024359977,0.011317121,-0.014633101,-0.005936675,-0.021393422,-0.017385721,-0.007298723,-0.02494473,-0.0005794052,0.0110390065,0.005473151,0.011260072,-0.009527205,0.008856877,0.001037581,-0.007808599,0.0002725433,-0.0011365255,-0.0050417166,-0.02731227,-0.0040540537,0.0005388468,0.002681309,-0.021393422,-0.0021375595,-0.0037224556,-0.0009288311,-0.0212508,0.02524424,-0.027412105,0.0049204873,-0.0058297077,-0.0068744197,-0.026099976,0.011302859,0.00037839616,-0.011866218,-0.017114738,0.003003993,-0.011909005,0.0012996504,0.035085212,0.027426368,0.0018737073,-0.008514582,0.028039645,-0.029950792,-0.00031042748,-0.007095485,-0.012950152,0.0015884617,0.010411466,-0.022477357,-0.026299648,-0.004432004,0.0063823713,0.02500178,-0.0015884617,0.01749982,-0.00051433354,0.00091278605,0.022420308,0.022505881,0.021963915,0.006642658,0.00068369816,0.0068851165,-0.005861798,0.01694359,0.020922767,-0.0245026,0.0016882976,0.0010652142,-0.018911786,0.003444341,-0.009890893,-0.0018469655,-0.0039149965,0.0032179274,0.016358837,-0.006175568,-0.027483417,0.014276544,0.010140482,-0.03562718,0.008350566,-0.0023194037,0.0042465944,0.005080938,-0.007480567,-0.0079583535,0.031890463,0.012885972,0.022976536,-0.014718675,0.018512443,0.029551448,-0.007701632,0.003137702,-0.015075232,0.0112458095,0.04175996,0.024245879,0.028282104,0.0122869555,-0.0040718815,0.016301788,-0.025515223,0.015959494,-0.012122939,-0.035855375,-0.002631391,0.014861298,0.0041217995,-0.011830563,0.000007120695,0.020865718,0.011431219,-0.0051023313,-0.010425728,-0.011067531,-0.012351136,-0.013328102,0.015973756,-0.007077657,0.00042274295,0.008699992,0.0004392337,0.029038006,0.0038329882,0.013870069,0.017057689,0.011809169,0.0004383423,0.009862368,0.005294872,0.0139556425,0.008215074,0.0022356126,0.0047457744,-0.00956286,-0.028139481,0.044384222,-0.035028163,0.0072345426,-0.0143122,0.0065214285,-0.008015403,0.024802107,-0.026399484,-0.017285885,-0.022591455,0.012536545,0.01506097,0.03873636,0.00008289951,0.00077328307,0.026342435,-0.0048135202,0.00425016,-0.015446051,0.0038365538,0.020009981,0.0046245446,-0.01262212,-0.6768308,-0.0027347927,-0.0001291405,0.00637524,-0.005512372,0.029009482,0.020295227,0.007794337,-0.034172427,0.0072095837,-0.0014458388,0.031262923,-0.0043036435,-0.019296868,-0.012244169,-0.00043544528,0.023261782,0.008671467,-0.0071525346,0.013192611,-0.022263423,0.012272693,-0.01949654,0.0036868,0.015831133,0.0005433038,-0.011909005,-0.026456533,-0.013912856,-0.009541467,-0.022206374,0.021835553,0.009270484,0.010233187,0.056792405,-0.027540466,-0.016529985,0.03711046,0.021521783,0.034115378,-0.022734078,0.0061613056,0.021436209,0.00023265347,-0.0023318832,0.00042608567,0.012044497,0.009056549,-0.0073022884,-0.005901019,0.021421947,0.0032981527,-0.017585393,0.011046138,0.012943021,-0.008899664,0.014483348,-0.012893103,0.015645724,0.007288026,-0.012885972,0.0060971254,-0.021835553,-0.0050916346,-0.004075447,0.007173928,-0.004061185,0.015645724,-0.0048527415,-0.016915066,0.003918562,0.035028163,-0.018298507,-0.017300148,-0.0028132352,0.0056478637,0.055736996,-0.015217855,-0.0021678668,-0.0005950046,0.0040790127,-0.016444411,-0.007551878,-0.016073592,0.017129,-0.00468516,-0.012073021,0.013599086,0.018184409,-0.019282605,0.017200312,0.016957853,0.0015251727,-0.013741708,-0.03311702,0.025101615,-0.0024923338,-0.0025779074,0.01687228,-0.033288166,-0.014076872,-0.00094755035,0.015160806,0.004514012,-0.0042965123,0.010454252,0.0063716746,0.01844113,0.014084003,-0.026513582,0.0062932316,0.0083220415,-0.013898593,-0.01749982,0.0026545671,-0.038279966,0.011987448,-0.00061060395,0.0236326,0.0020377235,0.02193539,-0.0020876415,0.017228836,-0.030635381,0.011488268,-0.0011507878,-0.0058225766,-0.002588604,-0.024160305,-0.013199742,-0.0026456532,0.013527774,0.0343721,0.006075732,0.009676958,-0.004613848,0.012008841,-0.017243098,0.015046707,-0.0102545805,-0.007744419,-0.029893743,0.004856307,-0.0030325176,0.0074163866,-0.027155384,-0.009177778,0.011210154,-0.020808669,0.017770803,-0.00020858587,-0.007894173,-0.024402764,-0.003586964,0.0009858803,-0.0110390065,0.0033302428,-0.015346215,-0.009862368,-0.010511301,0.016900804,0.0294944,-0.012479496,-0.00017281875,0.0033338084,-0.037395705,0.012843185,0.0019129285,0.007223846,-0.029380301,-0.001187335,-0.0070669604,-0.005487413,0.010340154,0.002248092,-0.0074591734,-0.009085073,0.017228836,0.008158025,-0.0126863,0.022448832,-0.0008303322,-0.021464733,-0.004806389,0.034600295,0.0047350777,0.023033585,0.011367039,-0.023489978,-0.009648434,-0.01256507,-0.008386222,-0.0056229047,-0.010176138,0.0014119659,-0.0007028631,0.0057797898,-0.0064322893,0.0088426145,0.030007841,0.016743919,-0.0017631745,0.02856735,0.00581188,0.019211294,-0.022548668,0.01206589,-0.011231547,0.009491549,0.013178349,0.008486058,-0.0286244,-0.012301218,-0.009341795,0.0010839334,0.023390142,-0.020423587,0.0023104895,-0.016273264,0.0010054909,-0.0064536827,-0.012764743,-0.006713969,0.0026991367,-0.014661626,0.007644583,0.008457533,0.0063716746,-0.0039791767,-0.0061363466,-0.0034799967,0.030892102,-0.005326962,0.014333594,-0.003868644,0.015118019,0.045268483,-0.015859658,0.034429148,-0.0015786564,-0.0036012263,0.03006489,0.02744063,0.010176138,0.010111958,-0.0014476216,0.026413746,-0.005262782,-0.0025832558,-0.011909005,0.021550307,0.0059865927,-0.018355556,0.0047279466,0.024431288,-0.0049775364,0.007694501,0.013891462,0.015431789,0.007095485,0.017114738,0.017399983,0.012037366,-0.0043357336,0.030407185,-0.013663266,-0.009470155,-0.0070812227,-0.006000855,0.006674748,-0.016116379,-0.010561219,0.026584893,-0.00069617765,-0.000651608,-0.026713254,-0.0056514293,0.018412605,0.02980817,-0.0033979886,-0.0049097906,-0.029551448,0.02943735,0.016472936,-0.0053305277,-0.022762602,-0.030778004,-0.013028595,-0.015446051,0.017057689,-0.005901019,-0.010803678,0.014440561,0.0016784923,0.0117663825,-0.017043427,0.004949012,0.014240888,-0.014661626,-0.00025048133,-0.006089994,-0.011737858,-0.010497039,-0.010361548,0.015317691,0.0026510016,-0.011381301,-0.0070491326,-0.020979816,0.0057084784,0.006639092,0.0147472,-0.018968835,-0.016644083,-0.020466374,-0.0065606497,-0.013142693,0.014248019,0.020009981,0.01655851,-0.025329813,-0.012336873,-0.015588674,-0.013399414,0.019168507,0.020765882,0.006393068,0.0327462,-0.0072024525,0.01587392,-0.020409325,-0.023361618,0.034115378,-0.018869,-0.008607287,-0.011602366,0.008550238,-0.0077800746,-0.00034184908,0.015018183,0.017043427,-0.021150963,-0.016786706,-0.023974895,-0.0076160585,-0.010468515,-0.0004693182,0.035997998,0.00290594,-0.0027454894,0.010183269,0.016729657,0.035227835,-0.0326321,-0.01349925,0.015973756,0.023661125,0.015175068,-0.014504741,0.014141052,-0.013477856,-0.01694359,0.012572201,0.005537331,0.022833914,0.014098265,0.0064643794,-0.0092633525,0.0006422484,-0.029522924,-0.012672038,0.020608997,0.0046530697,-0.019453753,0.02256293,0.019111458,-0.01844113,-0.021664405,0.016287526,0.017100476,-0.013991298,-0.013442201,-0.0006137238,-0.0122869555,-0.023661125,-0.011117449,0.013271053,-0.004125365,-0.024174567,-0.028168006,-0.010425728,-0.0059616338,-0.011780645,0.0030984806,-0.0052841753,-0.008828352,0.0010340154,0.022648504,0.027340794,-0.0011588105,0.015089494,-0.011744989,0.013342365,0.02738358,-0.011367039,-0.031205872,-0.0013665048,-0.0196249,0.011395563,0.011260072,-0.008143763,-0.030036366,0.0033070666,0.03137702,0.0253726,0.006517863,0.012429578,-0.016601296,-0.00019332077,-0.0035816156,0.0178849,0.003743849,-0.008108107,-0.024474075,0.0051344214,-0.035598654,-0.004036226,-0.01231548,0.00793696,-0.013456463,-0.0009974684,0.030093415,-0.02475932,-0.017599655,0.016344575,-0.02163588,0.012536545,-0.010525564,-0.02356129,0.0052592163,0.0005941132,0.02581473,0.0012622119,-0.023518503,-0.033601936,-0.03836554,0.02156457,0.022505881,0.00906368,0.00034742028,0.015774084,-0.027954072,-0.014276544,0.011509662,-0.015545887,0.023604076,0.018926049,-0.018869,-0.036026523,0.0057583963,0.003478214,0.013670397,-0.0127076935,-0.013242529,0.00215717,0.0020038506,0.011566711,-0.016915066,-0.00329637,-0.042530123,0.0034247304,-0.00094576756,-0.016230477,0.02137916,-0.020794407,-0.0024441986,-0.012579332,-0.0124438405,-0.014989658,-0.024459813,-0.010703842,-0.0088426145,0.033773083,0.012836054,0.016515722,-0.01206589,0.009249089,-0.0018291377,-0.015531625,-0.01812736,0.012729087,0.0064465515,-0.015118019,0.027269483,0.016259002,0.013934249,0.011716465,0.0033088494,-0.0016178776,0.014248019,-0.0018006131,-0.03294587,-0.008493189,-0.01725736,-0.0023782356,0.007929829,-0.040961273,0.0027312269,-0.00063288875,0.0040219636,0.011538186,0.008464664,0.0015028879,-0.014519003,0.020708833,-0.0063823713,0.014761462,-0.0055195033,-0.022135062,-0.011545317,-0.0050845034,0.0010964129,0.0009778577,0.0069671245,0.00084102893,-0.0062932316,-0.0027347927,0.013649004,-0.021963915,0.0056835194,-0.028909646,-0.011010482,0.0032696282,-0.033858657,-0.013741708,-0.020466374,-0.0044034794,-0.034286525,-0.0030717389,0.018583754,-0.0042038076,0.0072095837,-0.000023900464,-0.026099976,0.011944661,-0.0048919627,0.02093703,0.012807529,0.032090135,0.0357698,-0.010896383,-0.038764883,-0.01150253,0.008906795,-0.0030753044,0.020452112,0.011851956,0.002257006,-0.010283105,0.031262923,-0.0066141332,-0.019325392,-0.028980957,0.029166367,0.022463094,0.011602366,-0.023233257,-0.016273264,-0.01624474,0.0022534404,-0.027982596,-0.006007986,-0.016387362,-0.010047778,-0.02119375,0.016701132,-0.036996357,0.024088994,0.013805889,-0.00825073,-0.00537688,-0.015545887,-0.009170647,0.021179488,0.0055658557,0.036796685,-0.0027151818,-0.0045354054,-0.0020626825,0.0060864286,-0.041845534,-0.011345645,-0.0072951573,0.027183909,-0.036055047,0.000040391227,0.018041786,-0.008036796,0.019525064,-0.0038615128,-0.025030304,-0.029608497,-0.006799543,-0.025857517,0.029893743,0.020423587,-0.026827352,-0.010867858,-0.021436209,-0.016772443,-0.01681523,-0.004432004,0.0028631531,0.020551948,-0.0014378163,-0.021421947,0.0033748124,0.009520073,-0.0053661834,-0.015260641,0.014212363,0.01794195,-0.010611137,0.013755971,-0.0017373242,-0.0101904,-0.013663266,0.0069279033,-0.010589744,-0.01749982,0.01757113,-0.008642943,-0.020651784,-0.0019414531,0.009905155,0.018341294,0.0064715105,-0.010076302,0.032603577,0.010333023,-0.025172926,-0.00084102893,-0.010283105,0.009612778,-0.004973971,-0.00534479,0.0027526205,-0.009092204,-0.0030164726,-0.0037973325,0.018170146,0.011267203,-0.02801112,-0.022919487,-0.010989089,0.011416957,-0.004424873,-0.029922267,-0.0041895453,-0.019254081,-0.0049276184,-0.00047867783,-0.012272693,-0.008864008,0.008022534,0.008464664,-0.018840475,0.0055836835,0.0041538896,-0.027483417,-0.004731512,-0.013349496,-0.017514082,-0.009712614,0.0058225766,0.009755401,0.021749979,-0.011716465,-0.039962914,-0.0026527843,-0.025344076,-0.019924408,-0.006863723,0.0023033584,0.022420308,-0.0019664122,-0.011538186,0.03457177,0.007537616,0.022534406,-0.0031680095,-0.010297367,-0.015973756,0.00005470922,0.021578832,0.0065535186,-0.018540967,-0.009470155,0.03337374,0.00425016,0.022020964,0.006082863,-0.008293517,-0.017670967,-0.011317121,-0.0148470355,0.014454823,-0.010333023,0.018769164,-0.034143902,0.003021821,0.011673678,0.006393068,-0.012992939,-0.009106467,0.0028168007,0.0015492403,0.0024138913,-0.010525564,-0.016230477,0.005401839,-0.021621618,0.011110318,0.014034085,-0.024459813,0.012458103,0.0049347496,-0.006631961,-0.009120729,-0.021265062,-0.018826213,0.0070313048,0.021835553,-0.01662982,-0.0052734786,-0.0010268843,0.03074948,-0.009648434,0.007837124,-0.012023103,-0.0012586464,-0.016786706,0.04124652,0.011695071,0.013670397,0.0071525346,0.015859658,-0.0045746267,-0.0057013473,0.003453255,-0.0036226197,-0.003929259,-0.0121300705,0.015103756,-0.021222275,-0.035541605,0.006350281,0.0039470866,-0.015731297,0.02437424,0.20777293,-0.005826142,-0.0012319046,0.03545603,-0.024103256,-0.016972115,0.03243243,0.000112371185,-0.008357697,0.005548028,0.010161876,0.00046174138,-0.018355556,-0.002408543,0.024359977,0.0006828067,-0.033773083,-0.034229476,-0.01537474,0.0095771225,0.0003692594,0.006542822,-0.009762532,0.0043107746,0.011737858,0.007430649,0.0067104036,0.015816871,0.011666547,-0.0001809527,-0.0049525774,-0.0028791982,0.0064322893,0.00048670036,-0.0048277825,0.01031163,-0.005925978,-0.019410966,0.026328173,0.011117449,-0.01112458,0.0037723735,0.014026954,0.014818511,0.013242529,0.0019468014,-0.01855523,-0.014347856,0.021878341,0.02574342,-0.031918988,-0.0043214713,0.037738,-0.0013112385,-0.0082721235,0.017699491,0.028638663,-0.0203808,-0.013841544,0.0059224125,-0.009384582,-0.0031466158,-0.012664907,0.02943735,-0.0051736427,0.0041146684,-0.016087854,-0.010639662,0.009826712,-0.02769735,0.009840975,-0.007737288,-0.022591455,0.0049169217,-0.020865718,-0.050288804,0.019639162,0.043899305,0.013142693,0.0147472,0.008728516,-0.0178849,-0.0029932964,-0.027226696,-0.034258,-0.027725875,0.025629321,0.017870639,0.008364828,0.0011062182,0.017285885,-0.012729087,-0.029237678,-0.023104897,0.012151464,0.012194251,-0.007744419,0.009584254,-0.0026741778,0.009890893,-0.017342934,0.019767523,0.0074734357,0.008450402,-0.007901304,0.006731797,0.00016869605,-0.01943949,-0.014889822,-0.022020964,0.005187905,-0.03457177,-0.019924408,0.030578332,0.01381302,0.009384582,-0.015588674,-0.0089994995,-0.0027847106,0.013506381,-0.0017007771,-0.025914567,-0.004588889,-0.003925693,0.0021215144,-0.0002355505,-0.027483417,0.009990728,0.005269913,-0.020637522,-0.0010268843,-0.014055478,0.01662982,-0.0067924117,-0.00357805,-0.0015118018,0.011602366,-0.011345645,-0.015246379,0.024802107,0.007263067,-0.018155884,0.0038329882,0.0006890465,0.00092437415,-0.031918988,0.037452754,-0.016087854,0.013948511,-0.02163588,-0.012108677,0.0006917207,0.007594665,-0.008293517,0.044355698,-0.015260641,-0.04281537,-0.0310062,-0.016287526,0.016729657,-0.014447692,-0.02581473,0.03451472,-0.01587392,0.0046102824,-0.010960564,-0.189289,0.013335234,0.01400556,-0.0011249374,0.012650644,-0.0077800746,0.015046707,-0.0068031084,-0.009356057,-0.0064465515,0.018883262,-0.009327533,-0.033801608,-0.022406045,0.00033382652,-0.00050408253,-0.0071561,0.015103756,0.008714254,0.020894242,0.022505881,-0.012657776,-0.0027365754,-0.006849461,0.014319331,-0.0050096265,-0.0066105677,0.017171787,-0.0019361047,-0.015560149,-0.0028007557,-0.016016543,0.011295727,0.0011383083,0.013285316,0.007537616,-0.023775224,0.009698352,0.0060400763,0.021792766,-0.0008650965,0.025800468,-0.007430649,-0.024916206,-0.009976466,0.03999144,-0.0024014118,-0.0064322893,0.012008841,-0.016529985,0.0055836835,-0.024388501,0.003775939,0.0005219104,-0.010710973,0.029836694,-0.028039645,0.0005540005,0.00315553,-0.0008789131,-0.006232617,-0.027012762,0.0035851812,-0.007951222,0.0048099547,-0.022291947,-0.023575552,-0.0055302,-0.04769307,0.024359977,0.0007010803,-0.026584893,0.0056157736,-0.009163516,0.0074235178,0.0011276116,0.006425158,0.026513582,0.0075162225,0.008821221,0.0073522064,0.03137702,-0.017014902,0.0060543385,0.009755401,0.0077087632,0.012650644,0.017785065,-0.006699707,-0.021036865,0.016743919,-0.013584823,-0.008785565,-0.01193753,-0.006175568,0.036311768,0.003569136,0.012051628,0.014804249,-0.007530485,0.016201952,0.0014520786,-0.028524563,0.011980317,0.04675176,-0.008906795,0.0007839798,0.016159166,0.02587178,-0.014276544,-0.017457033,-0.008664336,0.020680308,0.015774084,0.0029576407,0.005958068,-0.015774084,0.006257576,0.021849815,-0.02356129,0.05274192,0.0061434777,0.00072960486,0.0053412244,-0.00020145474,-0.012408185,-0.08363402,-0.036283243,0.009413106,0.02880981,-0.010183269,0.009698352,0.017542606,0.013734577,0.0069100754,0.021721454,-0.014832773,-0.02437424,-0.01487556,-0.018269982,0.034115378,-0.014397774,0.0011374169,0.0114026945,-0.023604076,0.028738499,0.016030805,-0.002565428,0.0062682726,-0.01731441,-0.0023443627,-0.00074030156,-0.027668826,0.020480637,0.015531625,-0.002581473,0.0076731076,-0.015659986,0.027027024,-0.025700632,-0.0062219203,0.0196249,-0.023019323,-0.011716465,0.01819867,-0.013984167,0.008407615,0.010632531,0.012194251,-0.026014403,0.008036796,0.0007215823,-0.0014868429,0.016843755,0.0163731,-0.020109817,-0.029408826,0.010632531,-0.02587178,-0.027012762,0.028838335,-0.0021928258,0.029865218,0.029294727,-0.008207943,0.01237966,-0.00096983515,-0.0127076935,-0.015988018,0.04461242,-0.012857447,-0.0067211003,-0.026342435,-0.016487198,0.0058297077,-0.009976466,-0.007544747,0.0038151604,0.0014547528,-0.0005294872,-0.031177348,0.009776794,-0.03468587,0.00061238674,0.015788347,-0.016387362,-0.003818726,-0.01568851,0.01874064,-0.011024744,0.03805177,0.009049417,0.012115808,0.008150894,0.011359908,-0.013456463,-0.009669827,0.015317691,0.013634741,-0.019738998,-0.01218712,-0.0023639733,0.0041360618,-0.0019735433,0.015246379,0.0037010622,-0.00637524,-0.020238178,-0.047094055,0.029323252,-0.009769663,-0.0010848248,0.0034799967,0.00949868,0.009755401,0.0022997928,-0.011481137,-0.0013905725,-0.023133421,0.0014271196,-0.0025244239,0.0014912998,-0.037281606,-0.03950652,0.038279966,0.012308349,0.0022356126,0.007216715,0.0026438704,0.010176138,0.0073522064,0.019097196,0.0049169217,-0.0047778646,0.0015126932,0.006820936,0.0012506238,-0.03037866,-0.000516562,-0.03562718,0.008821221,0.034172427,-0.013399414,-0.031976037,0.010119089,0.02056621,0.017984737,0.030778004,-0.018098835,-0.016016543,0.0031002634,0.0047849957,-0.02163588,0.015645724,0.00028613702,0.018498179,0.017228836,-0.005180774,0.029237678,0.011980317,0.007837124,-0.025415387,-0.023589814,-0.0261285,0.041788485,-0.0067424937,-0.015175068,-0.01537474,0.029080793,0.019724736,0.02137916,-0.015945232,0.020238178,-0.0032161446,-0.004799258,0.0051272903,0.017827852,-0.019011622,-0.0261285,-0.007166797,0.018612279,0.012486627,0.015973756,-0.013513512,-0.010846465,-0.005038151,-0.0075162225,0.018184409,0.014276544,0.0053875768,-0.031890463,0.0054410603,0.01844113,0.0023978462,-0.0019824572,0.00033984342,-0.008215074,0.019453753,-0.019653425,0.016544247,0.0009087748,-0.002431719,-0.0065784776,0.01262212,0.0007224737,0.016915066,0.029665546,0.020680308,0.03006489,-0.006264707,0.013670397,-0.018697852,-0.011081793,0.007273764,-0.014661626,-0.027141122,0.015674248,0.0008223097,0.016829493,-0.0126863,-0.0023479282,0.012108677,-0.007858518,-0.008978106,-0.008421877,-0.026542107,-0.037338655,0.019981457,0.032204233,0.030578332,0.02568637,-0.004182414,0.023803748,0.014198101,0.024802107,-0.013121299,0.017342934,0.00013393174,0.0130713815,0.003103829,-0.035798326,-0.013841544,-0.025515223,0.015845396,0.006532125,0.009249089,-0.02337588,0.06931469,0.028553087,-0.011859087,0.0103044985,0.004667332,0.02880981,0.0030663905,-0.0036101402,-0.022677029,-0.017100476,0.015560149,-0.021835553,0.0013638306,-0.014789986,0.0045247087,0.0075019603,-0.009755401,0.008735647,-0.023547027,-0.018027524,0.01162376,-0.008906795,0.0140626095,0.0027508377,-0.016487198,0.010889252,0.018983098,0.0058582323,-0.012508021,-0.010197531,0.000015641155,0.00082676666,-0.027996859,-0.01012622,0.009341795,-0.026542107,0.01031163,0.007815731,0.003262497,0.009698352,0.0025244239,0.054339293,-0.050659627,-0.038821932,0.02838194,-0.014732937,-0.021364897,-0.00046396986,-0.015103756]
  `;

    // #3 Load our key from the .env file
    const arweaveKey = JSON.parse(process.env.ARWEAVE_KEY!) as JWKInterface;

    // #4 Check out wallet balance. We should probably fail if too low?
    const arweaveWallet = await arweave.wallets.jwkToAddress(arweaveKey);
    const arweaveWalletBallance = await arweave.wallets.getBalance(
      arweaveWallet
    );
    console.log("arweaveWalletBallance", arweaveWalletBallance);

    // if (arweaveWalletBallance === "0") {
    //   return NextResponse.json(
    //     {
    //       message: "There's not enough balance",
    //     },
    //     { status: 400 }
    //   );
    // }

    // #5 Core flow: create a transaction, upload and wait for the status!
    let transaction = await arweave.createTransaction(
      { data: embeddings },
      arweaveKey
    );

    // let transaction = await arweave.createTransaction(
    //   { data: Buffer.from(embeddings, "base64") },
    //   arweaveKey
    // );
    // console.log("transaction", transaction);

    transaction.addTag("Content-Type", "text/plain");
    // Add another tag, maybe a key
    // transaction.addTag("Content-Type", "text/plain");

    await arweave.transactions.sign(transaction, arweaveKey);
    console.log("transaction", transaction);
    const response = await arweave.transactions.post(transaction);
    console.log("response", response);

    if (response?.status === 400) {
      return NextResponse.json(
        {
          message: response?.statusText,
          error: response?.data?.error,
        },
        { status: 400 }
      );
    }

    const status = await arweave.transactions.getStatus(transaction.id);
    console.log(
      `Completed transaction ${transaction.id} with status code ${status?.status}!`
    );

    console.log("status", status);
    return NextResponse.json(
      {
        uri: `https://www.arweave.net/${transaction.id}`,
      },
      { status: 200 }
    );
  } catch (error) {
    return NextResponse.json({
      error,
    });
  }
}
